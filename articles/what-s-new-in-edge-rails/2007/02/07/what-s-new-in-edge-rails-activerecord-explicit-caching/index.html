<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Edge Rails.info :: ActiveRecord Explicit Caching</title>
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <link href="/atom.xml" rel="alternate" title="Edge Rails.info" type="application/atom+xml" />
    <script type="text/javascript">
      //<![CDATA[
        var twitter_user = ""
        var show_replies = false;
        var tweet_count = 3;
      //]]>
    </script>
    <script src="http://ajax.googleapis.com/ajax/libs/mootools/1.2.4/mootools-yui-compressed.js" type="text/javascript"></script>
    <script src="/javascripts/mootools-1.2.4.2-more.js" type="text/javascript"></script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    <script src="/javascripts/twitter.js" type="text/javascript"></script>
  </head>
  <body id="">
    <div id="header">
      <div class="page_width">
        <a class="title" href="/">Edge Rails.info</a>
        <div id="search">
          <form action="http://www.google.com/cse" id="cse-search-box">
            <input name="cx" type="hidden" value="" />
            <input name="ie" type="hidden" value="UTF-8" />
            <input id="q" name="q" type="text" />
          </form>
        </div>
      </div>
    </div>
    <div id="nav">
      <div class="page_width">
        <ul>
          <li class="alpha">
            <a href="/">Blog</a>
          </li>
          <li class="omega">
            <a href="/about.html">About</a>
          </li>
          <li class="subscribe">
            <a href="/atom.xml">Subscribe</a>
          </li>
        </ul>
      </div>
    </div>
    <div id="page">
      <div class="page_width">
        <div id="main">
          <div class="blog">
            <div class="article">
              <h2>ActiveRecord Explicit Caching</h2>
              &#x000A;<p>A tiny but useful update was <a href="http://dev.rubyonrails.org/changeset/6138">just added</a> to edge Rails that lets you specify a block for which a query cache will be present.  The query cache will cache <code>select</code> statements and guarantee that identical select statements will only hit the database once during the block.  Any inserts, updates or deletes will clear the cache as the result of any cached queries may have changed.</p>&#x000A;<div class="highlight"><pre><span class="no">User</span><span class="o">.</span><span class="n">cache</span> <span class="k">do</span>&#x000A;  <span class="n">me</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># DB hit</span>&#x000A;  <span class="n">again</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># Cache hit</span>&#x000A;  <span class="n">me</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Not Ryan&#39;</span><span class="p">)</span>  <span class="c1"># Cache cleared</span>&#x000A;  <span class="n">me</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># DB hit</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;<p>While you might not think this is very useful in your various controller methods which <em>should</em> be of limited scope, think of your views that may call the same authentication queries several times within the view body.  While a simple @ <code>is_admin || = user.get_role('ADMIN')</code> custom cache mechanism would work just fine, you now have the options to wrap your view within a query cache and have it handled for you.</p>&#x000A;<p>The query cache is keyed on the raw <span class="caps">SQL</span> statement, so it&#8217;s very minimalist in its complexity.  It doesn&#8217;t know that your identical query with different order conditions is the same query as before &#8211; and will hit the db again.  It only caches identical <span class="caps">SQL</span> statements, literally.</p>
            </div>
            <p class="pubdate">
              Published:
              07 Feb, 2007
            </p>
            <p class="related_articles">
              <h2>Related Articles</h2>
              <ul></ul>
              <li>
                <a href="/articles/what-s-new-in-edge-rails/2009/02/01/what-s-new-in-edge-rails-nested-attributes">Nested Object Forms</a>
              </li>
              <li>
                <a href="/articles/what-s-new-in-edge-rails/2007/02/21/what-s-new-in-edge-rails-expanded-caching-scope">Expanded Caching Scope</a>
              </li>
              <li>
                <a href="/articles/what-s-new-in-edge-rails/2007/12/19/what-s-new-in-edge-rails-pluggable-controller-caching">Pluggable Controller Caching</a>
              </li>
            </p>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
              //<![CDATA[
                var disqus_url = "http://rwdaigle.github.com/edgerails/articles/what-s-new-in-edge-rails/2007/02/07/what-s-new-in-edge-rails-activerecord-explicit-caching";
              //]]>
            </script>
            <noscript>
              <a href="http://edgerails.disqus.com/?url=ref">View the discussion thread</a>
            </noscript>
            <script src="http://disqus.com/forums/edgerails/embed.js" type="text/javascript"></script>
          </div>
        </div>
        <div id="sidebar">
          <h4>Twitter <a class="small" href="http://twitter.com/">@</a></h4>
          <div id="twitter">
            <ul id="twitter_status">
              Status updating...
            </ul>
          </div>
          <h4>My Delicious <a class="small" href="http://delicious.com/">more &rarr;</a></h4>
          <div id="delicious">
            <script src="http://feeds.delicious.com/v2/js/?title=&amp;count=3&amp;sort=date&amp;extended" type="text/javascript"></script>
          </div>
        </div>
      </div>
    </div>
    <div id="footer">
      <div class="page_width">
        Copyright &copy; 2009 - Edge Rails.info -
        <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
      </div>
    </div>
    <!-- /Disqus Comments code -->
    <script type="text/javascript">
      //<![CDATA[
        (function() {
            var links = document.getElementsByTagName('a');
            var query = '?';
            for(var i = 0; i < links.length; i++) {
              if(links[i].href.indexOf('#disqus_thread') >= 0) {
                query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
              }
            }
            document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/edgerails/get_num_replies.js' + query + '"></' + 'script>');
          })();
      //]]>
    </script>
    <!-- /Google Analytics code -->
    <script type="text/javascript">
      //<![CDATA[
        try {
        var pageTracker = _gat._getTracker("");
        pageTracker._trackPageview();
        } catch(err) {}
      //]]>
    </script>
  </body>
</html>
