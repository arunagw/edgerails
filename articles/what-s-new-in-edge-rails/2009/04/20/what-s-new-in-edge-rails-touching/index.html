<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Edge Rails.info :: Touching</title>
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <link href="/atom.xml" rel="alternate" title="Edge Rails.info" type="application/atom+xml" />
    <script type="text/javascript">
      //<![CDATA[
        var twitter_user = ""
        var show_replies = false;
        var tweet_count = 3;
      //]]>
    </script>
    <script src="http://ajax.googleapis.com/ajax/libs/mootools/1.2.4/mootools-yui-compressed.js" type="text/javascript"></script>
    <script src="/javascripts/mootools-1.2.4.2-more.js" type="text/javascript"></script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    <script src="/javascripts/twitter.js" type="text/javascript"></script>
  </head>
  <body id="">
    <div id="header">
      <div class="page_width">
        <a class="title" href="/">Edge Rails.info</a>
        <div id="search">
          <form action="http://www.google.com/cse" id="cse-search-box">
            <input name="cx" type="hidden" value="" />
            <input name="ie" type="hidden" value="UTF-8" />
            <input id="q" name="q" type="text" />
          </form>
        </div>
      </div>
    </div>
    <div id="nav">
      <div class="page_width">
        <ul>
          <li class="alpha">
            <a href="/">Blog</a>
          </li>
          <li class="omega">
            <a href="/about.html">About</a>
          </li>
          <li class="subscribe">
            <a href="/atom.xml">Subscribe</a>
          </li>
        </ul>
      </div>
    </div>
    <div id="page">
      <div class="page_width">
        <div id="main">
          <div class="blog">
            <div class="article">
              <h2>Touching</h2>
              &#x000A;<hr/>&#x000A;<p><em>This feature was released in Rails v2.3.3</em><br />&#x000A;<hr/></p>&#x000A;<p>There are often times when you want an update made to one object to be reflected up the object graph as an update of an associated parent object.  For instance, if a new comment is created on an article, you may very well want to mark the article as being updated.  With the <a href="http://github.com/rails/rails/commit/abb899c54e8777428b7a607774370ba29a5573bd">new touch feature</a> of ActiveRecord, this is a whole lot easier.  Using our previous example, here&#8217;s is how it works:</p>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  <span class="n">has_many</span> <span class="ss">:comments</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;&#x000A;  <span class="c1"># Make create/update/deletes of a comment mark its</span>&#x000A;  <span class="c1"># parent article as updated</span>&#x000A;  <span class="n">belongs_to</span> <span class="ss">:article</span><span class="p">,</span> <span class="ss">:touch</span> <span class="o">=&gt;</span> <span class="kp">true</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="c1"># Adding a new comment marks the article as being updated</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">updated_at</span> <span class="c1">#=&gt; &quot;Mon Apr 20 07:42:53 -0400 2009&quot;</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:body</span> <span class="o">=&gt;</span> <span class="s2">&quot;New comment&quot;</span><span class="p">)</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">updated_at</span> <span class="c1">#=&gt; &quot;Mon Apr 20 07:43:27 -0400 2009&quot;</span>&#x000A;&#x000A;<span class="c1"># Same for updates/deletes</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">destroy</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">updated_at</span> <span class="c1">#=&gt; &quot;Mon Apr 20 07:45:23 -0400 2009&quot;</span>&#x000A;</pre>&#x000A;</div>&#x000A;<p>This is a great way to keep tightly coupled domain models in-sync without resorting to a potential maze of callback logic.</p>&#x000A;<p>Also, if you have a timestamp field named something other than the standard <code>updated_at</code> or <code>updated_on</code> you can explicitly specify that field as the value to the <code>:touch</code> option and it will get marked instead:</p>&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  <span class="n">has_many</span> <span class="ss">:comments</span>&#x000A;  <span class="n">validates_presence_of</span> <span class="ss">:last_updated_at</span>  <span class="c1"># non-standard</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>&#x000A;  <span class="n">belongs_to</span> <span class="ss">:article</span><span class="p">,</span> <span class="ss">:touch</span> <span class="o">=&gt;</span> <span class="ss">:last_updated_at</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="c1"># Adding a new comment marks the article as being updated</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">last_updated_at</span> <span class="c1">#=&gt; &quot;Mon Apr 20 07:42:53 -0400 2009&quot;</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:body</span> <span class="o">=&gt;</span> <span class="s2">&quot;New comment&quot;</span><span class="p">)</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">last_updated_at</span> <span class="c1">#=&gt; &quot;Mon Apr 20 07:43:27 -0400 2009&quot;</span>&#x000A;</pre>&#x000A;</div>&#x000A;<p>Also, somewhat conveniently, you can invoke <code>touch</code> directly on a model to update its timestamp outside any association callbacks:</p>&#x000A;<div class="highlight"><pre><span class="n">article</span><span class="o">.</span><span class="n">updated_at</span> <span class="c1">#=&gt; &quot;Mon Apr 20 07:42:53 -0400 2009&quot;</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">touch</span>&#x000A;<span class="n">article</span><span class="o">.</span><span class="n">updated_at</span> <span class="c1">#=&gt; &quot;Mon Apr 20 07:43:27 -0400 2009&quot;</span>&#x000A;</pre>&#x000A;</div>&#x000A;<p>So, touch away (in a non-creepy kind of way)!</p>
            </div>
            <p class="pubdate">
              Published:
              20 Apr, 2009
            </p>
            <p class="related_articles">
              <h2>Related Articles</h2>
              <ul></ul>
              <li>
                <a href="/articles/what-s-new-in-edge-rails/2009/02/01/what-s-new-in-edge-rails-nested-attributes">Nested Object Forms</a>
              </li>
              <li>
                <a href="/articles/what-s-new-in-edge-rails/2009/08/11/what-s-new-in-edge-rails-independent-model-validators">Independent Model Validators</a>
              </li>
              <li>
                <a href="/articles/what-s-new-in-edge-rails/2008/11/18/what-s-new-in-edge-rails-default-scoping">Default Scoping</a>
              </li>
            </p>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
              //<![CDATA[
                var disqus_url = "http://rwdaigle.github.com/edgerails/articles/what-s-new-in-edge-rails/2009/04/20/what-s-new-in-edge-rails-touching";
              //]]>
            </script>
            <noscript>
              <a href="http://edgerails.disqus.com/?url=ref">View the discussion thread</a>
            </noscript>
            <script src="http://disqus.com/forums/edgerails/embed.js" type="text/javascript"></script>
          </div>
        </div>
        <div id="sidebar">
          <h4>Twitter <a class="small" href="http://twitter.com/">@</a></h4>
          <div id="twitter">
            <ul id="twitter_status">
              Status updating...
            </ul>
          </div>
          <h4>My Delicious <a class="small" href="http://delicious.com/">more &rarr;</a></h4>
          <div id="delicious">
            <script src="http://feeds.delicious.com/v2/js/?title=&amp;count=3&amp;sort=date&amp;extended" type="text/javascript"></script>
          </div>
        </div>
      </div>
    </div>
    <div id="footer">
      <div class="page_width">
        Copyright &copy; 2009 - Edge Rails.info -
        <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
      </div>
    </div>
    <!-- /Disqus Comments code -->
    <script type="text/javascript">
      //<![CDATA[
        (function() {
            var links = document.getElementsByTagName('a');
            var query = '?';
            for(var i = 0; i < links.length; i++) {
              if(links[i].href.indexOf('#disqus_thread') >= 0) {
                query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
              }
            }
            document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/edgerails/get_num_replies.js' + query + '"></' + 'script>');
          })();
      //]]>
    </script>
    <!-- /Google Analytics code -->
    <script type="text/javascript">
      //<![CDATA[
        try {
        var pageTracker = _gat._getTracker("");
        pageTracker._trackPageview();
        } catch(err) {}
      //]]>
    </script>
  </body>
</html>
